if(typeof(akeeba)=="undefined"){var akeeba={}}if(typeof akeeba.Backup=="undefined"){akeeba.Backup={URLs:{},tag:"",backupid:null,currentDomain:null,domains:{},commentEditorSave:null,maxExecutionTime:14,runtimeBias:75,srpInfo:{},returnUrl:"",config_angiekey:"",defaultDescription:"",jpsKey:"",timeoutTimer:null,resumeTimer:null,resume:{enabled:true,timeout:10,maxRetries:3,retry:0}}}(function(a){akeeba.Backup.timer=function(b){if(b<=0){b=10}setTimeout("akeeba.Backup.timerTick()",b)};akeeba.Backup.timerTick=function(){try{console.log("Timer tick")}catch(b){}akeeba.Backup.resetTimeoutBar();akeeba.Backup.startTimeoutBar(akeeba.Backup.maxExecutionTime,akeeba.Backup.runtimeBias);akeeba.System.doAjax({ajax:"step",tag:akeeba.Backup.tag,backupid:akeeba.Backup.backupid},akeeba.Backup.onStep,akeeba.Backup.onError,false)};akeeba.Backup.startTimeoutBar=function(c,b){var d=0;akeeba.Backup.timeoutTimer=setInterval(function(){d++;var e=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",d.toFixed(0));a("#response-timer div.text").html(e)},1000)};akeeba.Backup.resetTimeoutBar=function(){Piecon.setOptions({color:"#333333",background:"#e0e0e0",shadow:"#000000",fallback:"force"});try{clearInterval(akeeba.Backup.timeoutTimer)}catch(b){}var c=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");a("#response-timer div.text").html(c)};akeeba.Backup.startRetryTimeoutBar=function(){var b=akeeba.Backup.resume.timeout;akeeba.Backup.resumeTimer=setInterval(function(){b--;a("#akeeba-retry-timeout").html(b.toFixed(0));if(b==0){clearInterval(akeeba.Backup.resumeTimer);akeeba.Backup.resumeBackup()}},1000)};akeeba.Backup.resetRetryTimeoutBar=function(){clearInterval(akeeba.Backup.resumeTimer);a("#akeeba-retry-timeout").html(akeeba.Backup.resume.timeout.toFixed(0))};akeeba.Backup.renderBackupSteps=function(c){var b="label-success";if(c==""){b="label-default"}a("#backup-steps").html("");a.each(akeeba.Backup.domains,function(d,e){var f=a(document.createElement("div")).addClass("label").html(e[1]).data("domain",e[0]).appendTo("#backup-steps");if(f.data("domain")==c){b="label-default";this_class="label-info"}else{this_class=b}f.addClass(this_class)})};akeeba.Backup.start=function(){try{console.log("Starting backup");console.log(data)}catch(g){}if(window.AVGRUN){try{console.warn("AVG Antivirus with Link Checker detected. The backup WILL fail!")}catch(g){}var d=confirm(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_AVGWARNING"));if(!d){return}}try{if(akeeba.Backup.commentEditorSave!=null){akeeba.Backup.commentEditorSave()}}catch(c){a("#comment").val("")}var f="";try{f=a("#jpskey").val()}catch(c){f=""}var h="";try{h=a("#angiekey").val()}catch(c){h=""}a("#backup-setup").hide("fast");a("#backup-progress-pane").show("fast");if(h&&(akeeba.Backup.config_angiekey=="")){a("#angie-password-warning").show()}var i=new Date();akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPSTARTED")+" "+i.toLocaleString());akeeba.Backup.renderBackupSteps("");akeeba.Backup.startTimeoutBar(akeeba.Backup.maxExecutionTime,akeeba.Backup.runtimeBias);akeeba.Backup.tag=akeeba.Backup.srpInfo.tag;var b={ajax:"start",description:a("#backup-description").val(),comment:a("#comment").val(),jpskey:f,angiekey:h};b=array_merge(b,akeeba.Backup.srpInfo);akeeba.System.doAjax(b,akeeba.Backup.onStep,akeeba.Backup.onError,false)};akeeba.Backup.onStep=function(f){try{console.log("Running backup step");console.log(f)}catch(g){}akeeba.Backup.renderBackupSteps(f.Domain);akeeba.Backup.currentDomain=f.Domain;var d=f.Progress+"%";a("#backup-percentage div.bar").css({width:f.Progress+"%"});if(f.Progress>=100){Piecon.setProgress(99)}else{Piecon.setProgress(f.Progress)}a("#backup-step").html(f.Step);a("#backup-substep").html(f.Substep);if(f.Warnings.length>0){a("#backup-percentage").addClass("progress-warning");a.each(f.Warnings,function(h,j){akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPWARNING"),j);var e=a(document.createElement("div")).html(j).appendTo(a("#warnings-list"))});if(a("#backup-warnings-panel").is(":hidden")){a("#backup-warnings-panel").show("fast")}}var c=f.Error;if(c!=""){try{console.error("Got an error message");console.log(c)}catch(g){}akeeba.Backup.onError(c);return}else{if(f.HasRun==1){try{console.log("Backup complete");console.log(c)}catch(g){}akeeba.Backup.onDone()}else{if(empty(akeeba.Backup.tag)){akeeba.Backup.tag="backend"}akeeba.Backup.backupid=f.backupid;akeeba.Backup.resume.retry=0;var b=10;if(f.hasOwnProperty("sleepTime")){b=f.sleepTime}try{console.log("Starting tick timer with waitTime = "+b+" msec")}catch(g){}akeeba.Backup.timer(b)}}};akeeba.Backup.resumeBackup=function(){akeeba.Backup.resetRetryTimeoutBar();a("#error-panel").hide("fast");a("#retry-panel").hide("fast");a("#backup-progress-pane").show("fast");if(a("#warnings-list").html()){a("#backup-warnings-panel").show("fast")}var b=new Date();akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPRESUME")+" "+b.toLocaleString());akeeba.Backup.timer()};akeeba.Backup.cancelResume=function(){akeeba.Backup.resetRetryTimeoutBar();var b=a("#backup-error-message-retry").html();akeeba.Backup.endWithError(b)};akeeba.Backup.onError=function(d){if(!akeeba.Backup.resume.enabled){akeeba.Backup.endWithError(d)}if(akeeba.Backup.resume.retry>=akeeba.Backup.resume.maxRetries){akeeba.Backup.endWithError(d);return}akeeba.Backup.resume.retry++;akeeba.Backup.resetRetryTimeoutBar();var b=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPHALT_DESC");var c=b.replace("%d",akeeba.Backup.resume.timeout.toFixed(0));akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPHALT"),c);a("#backup-progress-pane").hide("fast");a("#backup-warnings-panel").hide("fast");a("#error-panel").hide("fast");a("#backup-error-message-retry").html(d);a("#retry-panel").show("fast");akeeba.Backup.startRetryTimeoutBar()};akeeba.Backup.endWithError=function(d){akeeba.Backup.resetTimeoutBar();try{Piecon.reset()}catch(g){}var f=false;a("#backup-progress-pane").hide("fast");a("#backup-warnings-panel").hide("fast");a("#retry-panel").hide("fast");var b=akeeba.Backup.URLs.LogURL+"&tag="+akeeba.Backup.tag;var c=akeeba.Backup.URLs.AliceURL+"&log="+akeeba.Backup.tag;if(akeeba.Backup.backupid){b=b+"."+encodeURIComponent(akeeba.Backup.backupid);c=c+"."+encodeURIComponent(akeeba.Backup.backupid)}if(akeeba.Backup.currentDomain=="finale"){f=true;c+="&autorun=1"}a("#ab-viewlog-error").attr("href",b);a("#ab-alice-error").attr("href",c);akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPFAILED"),d);akeeba.System.doAjax({ajax:"pushFail",tag:akeeba.Backup.tag,backupid:akeeba.Backup.backupid,errorMessage:d},function(e){});a("#backup-error-message").html(d);a("#error-panel").show();if(f){setTimeout(function(){window.location=c},500)}};akeeba.Backup.onDone=function(){var d=new Date();akeeba.System.notification.notify(Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_BACKUPFINISHED")+" "+d.toLocaleString());akeeba.Backup.resetTimeoutBar();try{Piecon.reset()}catch(c){}a("#backup-progress-pane").hide("fast");a("#backup-complete").show();a("#backup-warnings-panel").width("100%");var b=akeeba.Backup.URLs.LogURL+"&tag="+akeeba.Backup.tag;if(akeeba.Backup.backupid){b=b+"."+encodeURIComponent(akeeba.Backup.backupid)}a("#ab-viewlog-success").attr("href",b);if(akeeba.Backup.returnUrl!=""){window.location=akeeba.Backup.returnUrl}};akeeba.Backup.restoreDefaultOptions=function(){a("#backup-description").val(akeeba.Backup.defaultDescription);if(a("#angiekey").length){a("#angiekey").val("ChromeIsDumb");a("#angiekey").val(akeeba.Backup.config_angiekey)}if(a("#jpskey").length){a("#jpskey").val("ChromeIsDumb");a("#jpskey").val(akeeba.Backup.jpsKey)}a("#comment").val("")};akeeba.Backup.flipProfile=function(){a("#flipDescription").val(a("#backup-description").val());a("#flipComment").val(a("#comment").val());document.forms.flipForm.submit()}}(akeeba.jQuery));